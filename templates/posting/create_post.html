{% extends 'basetmp/base.html' %}
{% load static %}
{% block head %}
{% endblock %}
{% block content %}
{% csrf_token %}


</div>

<!-- Форма создания поста -->
<div class="card create-post-card">
    <div class="card-body">
        <form id="createPostForm">
            <!-- Заголовок поста -->
            <div class="mb-4">
                <label for="postTitle" class="form-label">{{ post_title_2 }}</label>
                <input type="text" class="form-control" id="postTitle" placeholder="{{ enter_post_title }}" required>
                <div class="form-text">{{ should_be }}</div>
            </div>

            <!-- Содержание поста -->
            <div class="mb-4">
                <label for="postContent" class="form-label">{{ post_content }}</label>
                <div class="editor-toolbar">
                    <button type="button" class="btn btn-sm btn-editor" data-action="bold" title="Жирный">
                        <i class="ph ph-text-b"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="italic" title="Курсив">
                        <i class="ph ph-text-italic"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="underline" title="Подчеркнутый">
                        <i class="ph ph-text-underline"></i>
                    </button>
                    <span class="toolbar-divider"></span>
                    <button type="button" class="btn btn-sm btn-editor" data-action="heading" title="Заголовок">
                        <i class="ph ph-text-h"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="list-ul" title="Маркированный список">
                        <i class="ph ph-list-bullets"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="list-ol" title="Нумерованный список">
                        <i class="ph ph-list-numbers"></i>
                    </button>
                    <span class="toolbar-divider"></span>
                    <button type="button" class="btn btn-sm btn-editor" data-action="link" title="Ссылка">
                        <i class="ph ph-link"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="image" title="Изображение">
                        <i class="ph ph-image"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="emoji" title="Эмодзи">
                        <i class="ph ph-smiley"></i>
                    </button>
                </div>
                <textarea class="form-control content-editor" id="postContent" rows="8" placeholder="{{ enter_post_content }}..." required></textarea>
            </div>

            <!-- Загрузка изображения -->
            <div class="mb-4">
                <label class="form-label">{{ post_image }}</label>
                <div class="image-upload-container">
                    <div class="image-upload-area" id="imageDropArea">
                        <input type="file" id="postImage" class="image-upload-input" accept="image/*" hidden>
                        <div class="image-upload-placeholder">
                            <i class="ph ph-image-square"></i>
                            <p>{{ image_drop }} <span class="browse-link">{{ choose_file }}</span></p>
                            <small class="text-muted">PNG, JPG {{ or }} GIF, {{ max }} 5MB</small>
                            <div class="mt-3">
                                <button type="button" class="btn btn-outline-primary btn-sm" id="generateImageBtn">
                                    <i class="ph ph-magic-wand me-1"></i> {{ ai_generation }}
                                </button>
                            </div>
                        </div>
                        <div class="image-preview" id="imagePreview">
                            <img src="" alt="Предпросмотр" id="previewImg">
                            <button type="button" class="btn btn-sm btn-remove-image" id="removeImage">
                                <i class="ph ph-x"></i>
                            </button>
                        </div>
                    </div>
                    <div class="image-suggestions">
                        <p class="suggestion-title">{{ choice }}:</p>
                        <div class="suggestion-images">
                            <div class="suggestion-image" data-src="https://venyoo.ru/blog/wp-content/uploads/2017/04/10_Yml6ZXNwcm9jZXNz.jpg">
                                <img src="https://venyoo.ru/blog/wp-content/uploads/2017/04/10_Yml6ZXNwcm9jZXNz.jpg" alt="Предложение 1">
                            </div>
                            <div class="suggestion-image" data-src="https://sberbs.ru/uploads/models/announcement/announcement_image/70/0._Image_by_Freepik.jpg">
                                <img src="https://sberbs.ru/uploads/models/announcement/announcement_image/70/0._Image_by_Freepik.jpg" alt="Предложение 2">
                            </div>
                            <div class="suggestion-image" data-src="https://s0.rbk.ru/v6_top_pics/media/img/2/34/347186930962342.png">
                                <img src="https://s0.rbk.ru/v6_top_pics/media/img/2/34/347186930962342.png" alt="Предложение 3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Настройки публикации -->
            <div class="mb-4">
                <label class="form-label">{{ pub_settings }}</label>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="schedulePost">
                            <label class="form-check-label ms-sm-2" for="schedulePost">{{ schedule_post }}</label>
                        </div>
                        <div id="scheduleOptions" class="schedule-options">
                            <div class="mb-3">
                                <label for="publishDate" class="form-label">{{ pub_date }}</label>
                                <input type="date" class="form-control" id="publishDate">
                            </div>
                            <div class="mb-3">
                                <label for="publishTime" class="form-label">{{ pub_time }}</label>
                                <input type="time" class="form-control" id="publishTime">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="saveAsDraft" checked>
                            <label class="form-check-label ms-sm-2" for="saveAsDraft">{{ save_as_draft }}</label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enableComments" checked>
                            <label class="form-check-label ms-sm-2" for="enableComments">{{ allow_comments }}</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Хэштеги -->
            <div class="mb-4">
                <label for="postTags" class="form-label">{{ hashtags }}</label>
                <div class="tags-input-container">
                    <div class="tags-container" id="tagsContainer"></div>
                    <input type="text" class="form-control tags-input" id="postTags" placeholder="{{ add_hashtag }}">
                </div>
                <div class="form-text">{{ add_hashtags }}</div>
            </div>

            <!-- Выбор группы в виде чекбоксов с иконкой платформы -->
            <label for="postTags" class="form-label">Choose groups</label>
            <div class="mb-4">
                <label class="form-label">{{ group_selection_label }}</label>
                <div class="platform-selector">
                    {% for group in groups_data %}
                    <div class="form-check form-check-inline platform-option">
                        <input
                            class="form-check-input"
                            type="checkbox"
                            name="group_ids[]"
                            id="group{{ group.id }}"
                            value="{{ group.id }}"
                        >
                        <label class="form-check-label" for="group{{ group.id }}">
                            <span class="platform-text">{{ group.platform_text }}</span>
                            <span>{{ group.title }}</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Кнопки действий -->
            <div class="d-flex justify-content-between mt-5">
                <div>
                    <button type="button" class="btn btn-outline-secondary me-2" id="previewPostBtn">
                        <i class="ph ph-eye me-1"></i> {{ preview }}
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="generateWithAIBtn">
                        <i class="ph ph-magic-wand me-1"></i> {{ generate }}
                    </button>
                </div>
                <div>
                    <button type="button" class="btn btn-light me-2" id="saveDraftBtn">
                        <i class="ph ph-floppy-disk me-1"></i> {{ save_draft }}
                    </button>
                    <button type="submit" class="btn btn-primary" id="publishPostBtn">
                        <i class="ph ph-paper-plane-right me-1"></i> {{ publish }}
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Модальное окно предпросмотра -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalLabel">{{ post_preview }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="preview-container">
                    <div class="preview-platform-badge" id="previewPlatformBadge">LinkedIn</div>
                    <h3 class="preview-title" id="previewTitle">{{ post_title }}</h3>
                    <div class="preview-image-container" id="previewImageContainer">
                        <img src="" alt="{{ post_image }}" id="previewPostImage">
                    </div>
                    <div class="preview-content" id="previewContent">
                        {{ post_content_here }}...
                    </div>
                    <div class="preview-tags" id="previewTags"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ close }}</button>
                <button type="button" class="btn btn-primary" id="publishFromPreviewBtn">{{ publish }}</button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно генерации с ИИ -->
<div class="modal fade" id="aiGeneratorModal" tabindex="-1" aria-labelledby="aiGeneratorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aiGeneratorModalLabel">{{ gen_ai }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="aiPrompt" class="form-label">{{ what_post }}</label>
                    <textarea class="form-control" id="aiPrompt" rows="3" placeholder="Например: Напиши пост о преимуществах искусственного интеллекта в маркетинге для LinkedIn"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ gen_par }}</label>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-2">
                                <label for="aiTone" class="form-label small">{{ style }}</label>
                                <select class="form-select" id="aiTone">
                                    <option value="professional">{{ professional }}</option>
                                    <option value="friendly">{{ friendly }}</option>
                                    <option value="casual">{{ informal }}</option>
                                    <option value="enthusiastic">{{ enthusiastic }}</option>
                                    <option value="informative">{{ informative }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-2">
                                <label for="aiLength" class="form-label small">{{ length }}</label>
                                <select class="form-select" id="aiLength">
                                    <option value="short">{{ short }}</option>
                                    <option value="medium" selected>{{ medium }}</option>
                                    <option value="long">{{ long }}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ai-result-container" id="aiResultContainer">
                    <div class="ai-loading" id="aiLoading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">{{ loading }}...</span>
                        </div>
                        <p>{{ post_generation }}...</p>
                    </div>
                    <div class="ai-result" id="aiResult">
                        <h5>{{ generated_post }}</h5>
                        <div class="ai-result-content" id="aiResultContent"></div>
                        <div class="ai-result-actions mt-3">
                            <button type="button" class="btn btn-sm btn-outline-secondary me-2" id="regenerateBtn">
                                <i class="ph ph-arrows-clockwise me-1"></i> {{ regenerate }}
                            </button>
                            <button type="button" class="btn btn-sm btn-primary" id="useGeneratedBtn">
                                <i class="ph ph-check me-1"></i> {{ use }}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="token-usage mt-3">
                    <small class="text-muted">{{ сoins_used }}: <span id="tokensUsed">0</span> / {{ max_coins }}</small>
                    <div class="progress token-progress mt-1">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ cancel }}</button>
                <button type="button" class="btn btn-primary" id="generateBtn">{{ generate }}</button>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>

<!-- JavaScript для работы с мобильным меню -->
<script src = "{% static 'js/mobile_menu.js' %}"></script>

<script>
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        const toggleButton = document.querySelector('.toggle-sidebar');-->
<!--        const sidebar = document.querySelector('.sidebar');-->
<!--        const overlay = document.querySelector('.overlay');-->

<!--        if (toggleButton) {-->
<!--            toggleButton.addEventListener('click', function() {-->
<!--                sidebar.classList.toggle('show');-->
<!--                if (sidebar.classList.contains('show')) {-->
<!--                    overlay.style.display = 'block';-->
<!--                } else {-->
<!--                    overlay.style.display = 'none';-->
<!--                }-->
<!--            });-->
<!--        }-->

<!--        if (overlay) {-->
<!--            overlay.addEventListener('click', function() {-->
<!--                sidebar.classList.remove('show');-->
<!--                overlay.style.display = 'none';-->
<!--            });-->
<!--        }-->
<!--    });-->
</script>
<script>

</script>
<!-- JavaScript для работы с формой создания поста -->
<script src = "{% static 'js/createpost/createpost.js' %}"></script>

<!-- Модальное окно для генерации изображения с ИИ -->
<div class="modal fade" id="imageGeneratorModal" tabindex="-1" aria-labelledby="imageGeneratorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageGeneratorModalLabel">{{ ai_image_gen }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="imagePrompt" class="form-label">{{ describe }}</label>
                    <textarea class="form-control" id="imagePrompt" rows="3" placeholder="{{ example_1 }} {{ example_2 }} {{ example_3 }}"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">{{ image_style }}</label>
                    <div class="d-flex flex-wrap gap-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="styleRealistic" value="realistic" checked>
                            <label class="form-check-label" for="styleRealistic">{{ realistic }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="styleCartoon" value="cartoon">
                            <label class="form-check-label" for="styleCartoon">{{ cartoon }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="styleAbstract" value="abstract">
                            <label class="form-check-label" for="styleAbstract">{{ abstract }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="style3D" value="3d">
                            <label class="form-check-label" for="style3D">3D</label>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">{{ ratio }}</label>
                    <div class="d-flex flex-wrap gap-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageRatio" id="ratio1x1" value="1:1" checked>
                            <label class="form-check-label" for="ratio1x1">{{ square }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageRatio" id="ratio4x3" value="4:3">
                            <label class="form-check-label" for="ratio4x3">{{ ratio_4_3 }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageRatio" id="ratio16x9" value="16:9">
                            <label class="form-check-label" for="ratio16x9">{{ ratio_16_9 }}</label>
                        </div>
                    </div>
                </div>

                <!-- Контейнер для отображения результата генерации -->
                <div id="imageGenerationResult" class="mt-4" style="display: none;">
                    <h6>{{ gen_result }}:</h6>
                    <div class="image-generation-container">
                        <div id="imageGenerationLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">{{ loading }}...</span>
                            </div>
                            <p class="mt-2">{{ image_gen }}...</p>
                            <small class="text-muted">{{ 30_second_to_mars }}</small>
                        </div>
                        <div id="generatedImageContainer" style="display: none;">
                            <img id="generatedImage" src="" alt="Сгенерированное изображение" class="img-fluid rounded">
                        </div>
                    </div>

                    <!-- Информация об использовании токенов -->
                    <div class="token-usage mt-3">
                        <small class="text-muted">{{ сoins_used }}: <span id="imageTokensUsed">0</span> / {{ max_coins }}</small>
                        <div class="progress token-progress mt-1">
                            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ cancel }}</button>
                <button type="button" class="btn btn-primary" id="generateImageBtnSubmit">{{ generate }}</button>
                <button type="button" class="btn btn-success" id="useGeneratedImageBtn" style="display: none;">
                    {{ use_image }}
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Проверяем наличие элементов перед их использованием
        const generateImageBtn = document.getElementById('generateImageBtn');
        const imageGeneratorModalElement = document.getElementById('imageGeneratorModal');

        if (!generateImageBtn) {
            console.error('Элемент с ID "generateImageBtn" не найден');
            return;
        }

        if (!imageGeneratorModalElement) {
            console.error('Элемент с ID "imageGeneratorModal" не найден');
            return;
        }

        // Проверяем, доступен ли объект bootstrap
        if (typeof bootstrap === 'undefined') {
            console.error('Bootstrap JS не подключен');
            return;
        }

        // Инициализируем модальное окно
        const imageGeneratorModal = new bootstrap.Modal(imageGeneratorModalElement);

        // Получаем остальные элементы
        const generateImageBtnSubmit = document.getElementById('generateImageBtnSubmit');
        const imagePrompt = document.getElementById('imagePrompt');
        const imageGenerationResult = document.getElementById('imageGenerationResult');
        const imageGenerationLoading = document.getElementById('imageGenerationLoading');
        const generatedImageContainer = document.getElementById('generatedImageContainer');
        const generatedImage = document.getElementById('generatedImage');
        const useGeneratedImageBtn = document.getElementById('useGeneratedImageBtn');
        const imageTokensUsed = document.getElementById('imageTokensUsed');
        const previewImg = document.getElementById('previewImg');
        const imagePreview = document.getElementById('imagePreview');

        // Проверяем наличие всех необходимых элементов
        if (!generateImageBtnSubmit || !imagePrompt || !imageGenerationResult ||
            !imageGenerationLoading || !generatedImageContainer || !generatedImage ||
            !useGeneratedImageBtn || !imageTokensUsed || !previewImg || !imagePreview) {
            console.error('Не все необходимые элементы найдены');
            return;
        }

        // Обработчик для кнопки "Сгенерировать фото с помощью ИИ"
        generateImageBtn.addEventListener('click', function() {
            // Сбрасываем предыдущие результаты
            imageGenerationResult.style.display = 'none';
            generatedImageContainer.style.display = 'none';
            useGeneratedImageBtn.style.display = 'none';
            imagePrompt.value = '';

            // Открываем модальное окно
            imageGeneratorModal.show();
        });

        // Остальной код без изменений...

        // Обработчик для кнопки "Сгенерировать" в модальном окне
        generateImageBtnSubmit.addEventListener('click', function() {
            const prompt = imagePrompt.value.trim();
            if (prompt === '') {
                alert('{{ enter_description }}');
                return;
            }

            // Получаем выбранный стиль и соотношение сторон
            const style = document.querySelector('input[name="imageStyle"]:checked').value;
            const ratio = document.querySelector('input[name="imageRatio"]:checked').value;

            // Показываем индикатор загрузки
            imageGenerationResult.style.display = 'block';
            imageGenerationLoading.style.display = 'block';
            generatedImageContainer.style.display = 'none';
            useGeneratedImageBtn.style.display = 'none';

            // Имитация запроса к API
            setTimeout(function() {
                // Здесь должен быть запрос к API для генерации изображения
                // Для демонстрации используем заглушку с случайным изображением
                generateDummyImage(prompt, style, ratio);

                // Обновляем счетчик токенов
                const tokens = Math.floor(Math.random() * 800) + 200;
                imageTokensUsed.textContent = tokens;
                document.querySelector('#imageGenerationResult .progress-bar').style.width = (tokens / 5000 * 100) + '%';

                // Скрываем индикатор загрузки и показываем результат
                imageGenerationLoading.style.display = 'none';
                generatedImageContainer.style.display = 'block';
                useGeneratedImageBtn.style.display = 'inline-block';
            }, 3000);
        });

        // Функция для генерации примера изображения (заглушка)
        function generateDummyImage(prompt, style, ratio) {
            // Определяем размеры изображения в зависимости от соотношения сторон
            let width, height;
            switch(ratio) {
                case '1:1':
                    width = 512;
                    height = 512;
                    break;
                case '4:3':
                    width = 640;
                    height = 480;
                    break;
                case '16:9':
                    width = 640;
                    height = 360;
                    break;
                default:
                    width = 512;
                    height = 512;
            }

            // Генерируем случайное изображение с Unsplash Source
            // Используем параметры из запроса для получения релевантного изображения
            let keywords = prompt.split(' ').slice(0, 3).join(',');

            // Добавляем стиль в ключевые слова
            if (style === 'realistic') keywords += ',photo';
            if (style === 'cartoon') keywords += ',illustration';
            if (style === 'abstract') keywords += ',abstract';
            if (style === '3d') keywords += ',3d';

            // Генерируем URL для изображения
            const imageUrl = `https://source.unsplash.com/random/${width}x${height}/?${encodeURIComponent(keywords)}`;

            // Устанавливаем изображение
            generatedImage.src = imageUrl;
        }

        // Обработчик для кнопки "Использовать изображение"
        useGeneratedImageBtn.addEventListener('click', function() {
            // Устанавливаем сгенерированное изображение в предпросмотр
            previewImg.src = generatedImage.src;
            imagePreview.style.display = 'block';
            document.querySelector('.image-upload-placeholder').style.display = 'none';

            // Закрываем модальное окно
            imageGeneratorModal.hide();
        });
    });
    </script>

<!-- Phosphor Icons JavaScript -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>



{% endblock %}
