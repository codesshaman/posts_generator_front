{% extends 'basetmp/base.html' %}
{% load static %}
{% block head %}
{% endblock %}
{% block content %}
{% csrf_token %}


</div>

<!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
<div class="card create-post-card">
    <div class="card-body">
        <form id="createPostForm">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞ -->
            <div class="mb-4">
                <label for="postTitle" class="form-label">{{ post_title_2 }}</label>
                <input type="text" class="form-control" id="postTitle" placeholder="{{ enter_post_title }}" required>
                <div class="form-text">{{ should_be }}</div>
            </div>

            <!-- –í—ã–±–æ—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã -->
            <div class="mb-4">
                <label class="form-label">{{ platform }}</label>
                <div class="platform-selector">
                    <div class="form-check form-check-inline platform-option">
                        <input class="form-check-input" type="radio" name="platform" id="platformLinkedin" value="linkedin" checked>
                        <label class="form-check-label" for="platformLinkedin">
                            <i class="ph ph-linkedin-logo platform-icon linkedin"></i>
                            <span>LinkedIn</span>
                        </label>
                    </div>
                    <div class="form-check form-check-inline platform-option">
                        <input class="form-check-input" type="radio" name="platform" id="platformFacebook" value="facebook">
                        <label class="form-check-label" for="platformFacebook">
                            <i class="ph ph-facebook-logo platform-icon facebook"></i>
                            <span>Facebook</span>
                        </label>
                    </div>
                    <div class="form-check form-check-inline platform-option">
                        <input class="form-check-input" type="radio" name="platform" id="platformInstagram" value="instagram">
                        <label class="form-check-label" for="platformInstagram">
                            <i class="ph ph-instagram-logo platform-icon instagram"></i>
                            <span>Instagram</span>
                        </label>
                    </div>
                    <div class="form-check form-check-inline platform-option">
                        <input class="form-check-input" type="radio" name="platform" id="platformTwitter" value="twitter">
                        <label class="form-check-label" for="platformTwitter">
                            <i class="ph ph-twitter-logo platform-icon twitter"></i>
                            <span>Twitter</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
            <div class="mb-4">
                <label for="postContent" class="form-label">{{ post_content }}</label>
                <div class="editor-toolbar">
                    <button type="button" class="btn btn-sm btn-editor" data-action="bold" title="–ñ–∏—Ä–Ω—ã–π">
                        <i class="ph ph-text-b"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="italic" title="–ö—É—Ä—Å–∏–≤">
                        <i class="ph ph-text-italic"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="underline" title="–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π">
                        <i class="ph ph-text-underline"></i>
                    </button>
                    <span class="toolbar-divider"></span>
                    <button type="button" class="btn btn-sm btn-editor" data-action="heading" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                        <i class="ph ph-text-h"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="list-ul" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">
                        <i class="ph ph-list-bullets"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="list-ol" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">
                        <i class="ph ph-list-numbers"></i>
                    </button>
                    <span class="toolbar-divider"></span>
                    <button type="button" class="btn btn-sm btn-editor" data-action="link" title="–°—Å—ã–ª–∫–∞">
                        <i class="ph ph-link"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="image" title="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                        <i class="ph ph-image"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-editor" data-action="emoji" title="–≠–º–æ–¥–∑–∏">
                        <i class="ph ph-smiley"></i>
                    </button>
                </div>
                <textarea class="form-control content-editor" id="postContent" rows="8" placeholder="{{ enter_post_content }}..." required></textarea>
<!--                <div class="form-text"><p>{{ max_length }}: {{ max_length_num }} {{ characters_for }} {{ network }}</p></div>-->
            </div>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
            <div class="mb-4">
                <label class="form-label">{{ post_image }}</label>
                <div class="image-upload-container">
                    <div class="image-upload-area" id="imageDropArea">
                        <input type="file" id="postImage" class="image-upload-input" accept="image/*" hidden>
                        <div class="image-upload-placeholder">
                            <i class="ph ph-image-square"></i>
                            <p>{{ image_drop }} <span class="browse-link">{{ choose_file }}</span></p>
                            <small class="text-muted">PNG, JPG {{ or }} GIF, {{ max }} 5MB</small>
                            <div class="mt-3">
                                <button type="button" class="btn btn-outline-primary btn-sm" id="generateImageBtn">
                                    <i class="ph ph-magic-wand me-1"></i> {{ ai_generation }}
                                </button>
                            </div>
                        </div>
                        <div class="image-preview" id="imagePreview">
                            <img src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" id="previewImg">
                            <button type="button" class="btn btn-sm btn-remove-image" id="removeImage">
                                <i class="ph ph-x"></i>
                            </button>
                        </div>
                    </div>
                    <div class="image-suggestions">
                        <p class="suggestion-title">{{ choice }}:</p>
                        <div class="suggestion-images">
                            <div class="suggestion-image" data-src="https://venyoo.ru/blog/wp-content/uploads/2017/04/10_Yml6ZXNwcm9jZXNz.jpg">
                                <img src="https://venyoo.ru/blog/wp-content/uploads/2017/04/10_Yml6ZXNwcm9jZXNz.jpg" alt="–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 1">
                            </div>
                            <div class="suggestion-image" data-src="https://sberbs.ru/uploads/models/announcement/announcement_image/70/0._Image_by_Freepik.jpg">
                                <img src="https://sberbs.ru/uploads/models/announcement/announcement_image/70/0._Image_by_Freepik.jpg" alt="–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 2">
                            </div>
                            <div class="suggestion-image" data-src="https://s0.rbk.ru/v6_top_pics/media/img/2/34/347186930962342.png">
                                <img src="https://s0.rbk.ru/v6_top_pics/media/img/2/34/347186930962342.png" alt="–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ 3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
            <div class="mb-4">
                <label class="form-label">{{ pub_settings }}</label>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="schedulePost">
                            <label class="form-check-label ms-sm-2" for="schedulePost">{{ schedule_post }}</label>
                        </div>
                        <div id="scheduleOptions" class="schedule-options">
                            <div class="mb-3">
                                <label for="publishDate" class="form-label">{{ pub_date }}</label>
                                <input type="date" class="form-control" id="publishDate">
                            </div>
                            <div class="mb-3">
                                <label for="publishTime" class="form-label">{{ pub_time }}</label>
                                <input type="time" class="form-control" id="publishTime">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="saveAsDraft" checked>
                            <label class="form-check-label ms-sm-2" for="saveAsDraft">{{ save_as_draft }}</label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enableComments" checked>
                            <label class="form-check-label ms-sm-2" for="enableComments">{{ allow_comments }}</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –•—ç—à—Ç–µ–≥–∏ -->
            <div class="mb-4">
                <label for="postTags" class="form-label">{{ hashtags }}</label>
                <div class="tags-input-container">
                    <div class="tags-container" id="tagsContainer"></div>
                    <input type="text" class="form-control tags-input" id="postTags" placeholder="{{ add_hashtag }}">
                </div>
                <div class="form-text">{{ add_hashtags }}</div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="d-flex justify-content-between mt-5">
                <div>
                    <button type="button" class="btn btn-outline-secondary me-2" id="previewPostBtn">
                        <i class="ph ph-eye me-1"></i> {{ preview }}
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="generateWithAIBtn">
                        <i class="ph ph-magic-wand me-1"></i> {{ generate }}
                    </button>
                </div>
                <div>
                    <button type="button" class="btn btn-light me-2" id="saveDraftBtn">
                        <i class="ph ph-floppy-disk me-1"></i> {{ save_draft }}
                    </button>
                    <button type="submit" class="btn btn-primary" id="publishPostBtn">
                        <i class="ph ph-paper-plane-right me-1"></i> {{ publish }}
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalLabel">{{ post_preview }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="preview-container">
                    <div class="preview-platform-badge" id="previewPlatformBadge">LinkedIn</div>
                    <h3 class="preview-title" id="previewTitle">{{ post_title }}</h3>
                    <div class="preview-image-container" id="previewImageContainer">
                        <img src="" alt="{{ post_image }}" id="previewPostImage">
                    </div>
                    <div class="preview-content" id="previewContent">
                        {{ post_content_here }}...
                    </div>
                    <div class="preview-tags" id="previewTags"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ close }}</button>
                <button type="button" class="btn btn-primary" id="publishFromPreviewBtn">{{ publish }}</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –ò–ò -->
<div class="modal fade" id="aiGeneratorModal" tabindex="-1" aria-labelledby="aiGeneratorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aiGeneratorModalLabel">{{ gen_ai }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="aiPrompt" class="form-label">{{ what_post }}</label>
                    <textarea class="form-control" id="aiPrompt" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ –¥–ª—è LinkedIn"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ gen_par }}</label>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-2">
                                <label for="aiTone" class="form-label small">{{ style }}</label>
                                <select class="form-select" id="aiTone">
                                    <option value="professional">{{ professional }}</option>
                                    <option value="friendly">{{ friendly }}</option>
                                    <option value="casual">{{ informal }}</option>
                                    <option value="enthusiastic">{{ enthusiastic }}</option>
                                    <option value="informative">{{ informative }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-2">
                                <label for="aiLength" class="form-label small">{{ length }}</label>
                                <select class="form-select" id="aiLength">
                                    <option value="short">{{ short }}</option>
                                    <option value="medium" selected>{{ medium }}</option>
                                    <option value="long">{{ long }}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ai-result-container" id="aiResultContainer">
                    <div class="ai-loading" id="aiLoading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">{{ loading }}...</span>
                        </div>
                        <p>{{ post_generation }}...</p>
                    </div>
                    <div class="ai-result" id="aiResult">
                        <h5>{{ generated_post }}</h5>
                        <div class="ai-result-content" id="aiResultContent"></div>
                        <div class="ai-result-actions mt-3">
                            <button type="button" class="btn btn-sm btn-outline-secondary me-2" id="regenerateBtn">
                                <i class="ph ph-arrows-clockwise me-1"></i> {{ regenerate }}
                            </button>
                            <button type="button" class="btn btn-sm btn-primary" id="useGeneratedBtn">
                                <i class="ph ph-check me-1"></i> {{ use }}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="token-usage mt-3">
                    <small class="text-muted">{{ —Åoins_used }}: <span id="tokensUsed">0</span> / {{ max_coins }}</small>
                    <div class="progress token-progress mt-1">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ cancel }}</button>
                <button type="button" class="btn btn-primary" id="generateBtn">{{ generate }}</button>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>

<!-- JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleButton = document.querySelector('.toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.overlay');

        if (toggleButton) {
            toggleButton.addEventListener('click', function() {
                sidebar.classList.toggle('show');
                if (sidebar.classList.contains('show')) {
                    overlay.style.display = 'block';
                } else {
                    overlay.style.display = 'none';
                }
            });
        }

        if (overlay) {
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('show');
                overlay.style.display = 'none';
            });
        }
    });
</script>

<!-- JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const imageDropArea = document.getElementById('imageDropArea');
        const imageInput = document.getElementById('postImage');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const removeImageBtn = document.getElementById('removeImage');
        const browseLink = document.querySelector('.browse-link');
        const suggestionImages = document.querySelectorAll('.suggestion-image');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—ç—à—Ç–µ–≥–∞–º–∏
        const tagsInput = document.getElementById('postTags');
        const tagsContainer = document.getElementById('tagsContainer');
        const tags = [];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        const schedulePostCheckbox = document.getElementById('schedulePost');
        const scheduleOptions = document.getElementById('scheduleOptions');
        const saveAsDraftCheckbox = document.getElementById('saveAsDraft');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
        const previewPostBtn = document.getElementById('previewPostBtn');
        const previewTitle = document.getElementById('previewTitle');
        const previewContent = document.getElementById('previewContent');
        const previewPostImage = document.getElementById('previewPostImage');
        const previewPlatformBadge = document.getElementById('previewPlatformBadge');
        const previewTags = document.getElementById('previewTags');
        const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ò–ò
        const generateWithAIBtn = document.getElementById('generateWithAIBtn');
        const aiGeneratorModal = new bootstrap.Modal(document.getElementById('aiGeneratorModal'));
        const generateBtn = document.getElementById('generateBtn');
        const aiPrompt = document.getElementById('aiPrompt');
        const aiLoading = document.getElementById('aiLoading');
        const aiResult = document.getElementById('aiResult');
        const aiResultContent = document.getElementById('aiResultContent');
        const regenerateBtn = document.getElementById('regenerateBtn');
        const useGeneratedBtn = document.getElementById('useGeneratedBtn');
        const tokensUsed = document.getElementById('tokensUsed');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ñ–æ—Ä–º—ã
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const publishPostBtn = document.getElementById('publishPostBtn');
        const publishFromPreviewBtn = document.getElementById('publishFromPreviewBtn');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
        const editorButtons = document.querySelectorAll('.btn-editor');
        const contentEditor = document.getElementById('postContent');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        initForm();

        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
        function initForm() {
            // –°–∫—Ä—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            scheduleOptions.style.display = 'none';

            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            imagePreview.style.display = 'none';

            // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ò–ò –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            aiResult.style.display = 'none';
            aiLoading.style.display = 'none';

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                           (now.getMinutes() + 30).toString().padStart(2, '0');

            document.getElementById('publishDate').value = dateStr;
            document.getElementById('publishTime').value = timeStr;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        imageDropArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            imageDropArea.classList.add('dragover');
        });

        imageDropArea.addEventListener('dragleave', function() {
            imageDropArea.classList.remove('dragover');
        });

        imageDropArea.addEventListener('drop', function(e) {
            e.preventDefault();
            imageDropArea.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        });

        browseLink.addEventListener('click', function() {
            imageInput.click();
        });

        imageInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                handleImageFile(this.files[0]);
            }
        });

        removeImageBtn.addEventListener('click', function() {
            imageInput.value = '';
            previewImg.src = '';
            imagePreview.style.display = 'none';
            document.querySelector('.image-upload-placeholder').style.display = 'flex';
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        suggestionImages.forEach(function(img) {
            img.addEventListener('click', function() {
                const imgSrc = this.getAttribute('data-src');
                previewImg.src = imgSrc;
                imagePreview.style.display = 'block';
                document.querySelector('.image-upload-placeholder').style.display = 'none';
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function handleImageFile(file) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
            if (!file.type.match('image.*')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (5MB –º–∞–∫—Å–∏–º—É–º)
            if (file.size > 5 * 1024 * 1024) {
                alert('{{ size_must }}');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
                document.querySelector('.image-upload-placeholder').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ö—ç—à—Ç–µ–≥–æ–≤
        tagsInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                addTag(this.value.trim());
                this.value = '';
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö—ç—à—Ç–µ–≥–∞
        function addTag(tag) {
            if (tag === '') return;

            // –£–¥–∞–ª—è–µ–º # –≤ –Ω–∞—á–∞–ª–µ, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (tag.startsWith('#')) {
                tag = tag.substring(1);
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–≥ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω
            if (tags.includes(tag)) return;

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥ –≤ –º–∞—Å—Å–∏–≤
            tags.push(tag);

            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–µ–≥–∞
            const tagElement = document.createElement('div');
            tagElement.classList.add('tag');
            tagElement.innerHTML = `
                <span class="tag-text">#${tag}</span>
                <button type="button" class="btn-remove-tag" data-tag="${tag}">
                    <i class="ph ph-x"></i>
                </button>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            tagsContainer.appendChild(tagElement);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–≥–∞
            tagElement.querySelector('.btn-remove-tag').addEventListener('click', function() {
                const tagToRemove = this.getAttribute('data-tag');
                removeTag(tagToRemove);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ö—ç—à—Ç–µ–≥–∞
        function removeTag(tag) {
            // –£–¥–∞–ª—è–µ–º —Ç–µ–≥ –∏–∑ –º–∞—Å—Å–∏–≤–∞
            const index = tags.indexOf(tag);
            if (index !== -1) {
                tags.splice(index, 1);
            }

            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–µ–≥–∞ –∏–∑ DOM
            const tagElements = document.querySelectorAll('.tag');
            tagElements.forEach(function(element) {
                if (element.querySelector('.btn-remove-tag').getAttribute('data-tag') === tag) {
                    element.remove();
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        schedulePostCheckbox.addEventListener('change', function() {
            if (this.checked) {
                scheduleOptions.style.display = 'block';
                saveAsDraftCheckbox.checked = false;
            } else {
                scheduleOptions.style.display = 'none';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞
        saveAsDraftCheckbox.addEventListener('change', function() {
            if (this.checked) {
                schedulePostCheckbox.checked = false;
                scheduleOptions.style.display = 'none';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        previewPostBtn.addEventListener('click', function() {
            updatePreview();
            previewModal.show();
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function updatePreview() {
            const title = document.getElementById('postTitle').value || '{{ post_title }}';
            const content = document.getElementById('postContent').value || '{{ post_content_here }}...';
            const platform = document.querySelector('input[name="platform"]:checked').value;

            previewTitle.textContent = title;
            previewContent.innerHTML = formatContent(content);

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
            previewPlatformBadge.textContent = getPlatformName(platform);
            previewPlatformBadge.className = 'preview-platform-badge';
            previewPlatformBadge.classList.add('platform-' + platform);

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (previewImg.src) {
                previewPostImage.src = previewImg.src;
                document.getElementById('previewImageContainer').style.display = 'block';
            } else {
                document.getElementById('previewImageContainer').style.display = 'none';
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ö—ç—à—Ç–µ–≥–∏
            previewTags.innerHTML = '';
            tags.forEach(function(tag) {
                const tagSpan = document.createElement('span');
                tagSpan.classList.add('preview-tag');
                tagSpan.textContent = '#' + tag;
                previewTags.appendChild(tagSpan);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function formatContent(content) {
            // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ <br>
            content = content.replace(/\n/g, '<br>');
            return content;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        function getPlatformName(platform) {
            switch(platform) {
                case 'linkedin': return 'LinkedIn';
                case 'facebook': return 'Facebook';
                case 'instagram': return 'Instagram';
                case 'twitter': return 'Twitter';
                default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –ò–ò
        generateWithAIBtn.addEventListener('click', function() {
            aiGeneratorModal.show();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        generateBtn.addEventListener('click', function() {
            const prompt = aiPrompt.value.trim();
            if (prompt === '') {
                alert('{{ add_request }}');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            aiLoading.style.display = 'flex';
            aiResult.style.display = 'none';

            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API
            setTimeout(function() {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                const generatedContent = generateDummyContent(prompt);

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–∫–µ–Ω–æ–≤
                const tokens = Math.floor(Math.random() * 500) + 100;
                tokensUsed.textContent = tokens;
                document.querySelector('.token-usage .progress-bar').style.width = (tokens / 5000 * 100) + '%';
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                aiResultContent.innerHTML = generatedContent;
                aiLoading.style.display = 'none';
                aiResult.style.display = 'block';
            }, 2000);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞)
        function generateDummyContent(prompt) {
            const tone = document.getElementById('aiTone').value;
            const length = document.getElementById('aiLength').value;
            const platform = document.querySelector('input[name="platform"]:checked').value;

            let title = '';
            let content = '';

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø—Ä–æ—Å–∞
            if (prompt.toLowerCase().includes('–º–∞—Ä–∫–µ—Ç–∏–Ω–≥')) {
                title = '5 –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ 2023 –≥–æ–¥—É';
            } else if (prompt.toLowerCase().includes('–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç') || prompt.toLowerCase().includes('–∏–∏')) {
                title = '–ö–∞–∫ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã —É–∂–µ —Å–µ–≥–æ–¥–Ω—è';
            } else if (prompt.toLowerCase().includes('–ø—Ä–æ–¥–∞–∂–∏')) {
                title = '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ –Ω–∞ 30%: –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç';
            } else {
                title = '–¢—Ä–µ–Ω–¥—ã –∏–Ω–¥—É—Å—Ç—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—Ç –≤–∞—à –±–∏–∑–Ω–µ—Å –≤ –±–ª–∏–∂–∞–π—à–∏–µ 5 –ª–µ—Ç';
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–Ω–∞ –∏ –¥–ª–∏–Ω—ã
            let paragraphs = [];

            if (tone === 'professional') {
                paragraphs = [
                    '–í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—â–µ–º—Å—è –±–∏–∑–Ω–µ—Å-–ª–∞–Ω–¥—à–∞—Ñ—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ –∫—É—Ä—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç–µ–Ω–¥–µ–Ω—Ü–∏–π –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–π. –ö–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, –ø–æ–ª—É—á–∞—é—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ.',
                    '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –∏–Ω–≤–µ—Å—Ç–∏—Ä—É—é—â–∏–µ –≤ –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –Ω–∞ 26% –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏. –≠—Ç–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é –∏–Ω–Ω–æ–≤–∞—Ü–∏–π.',
                    '–î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, —É—á–∏—Ç—ã–≤–∞—é—â—É—é –∫–∞–∫ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –≤—ã–≥–æ–¥—ã, —Ç–∞–∫ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏.'
                ];
            } else if (tone === 'friendly') {
                paragraphs = [
                    '–ü—Ä–∏–≤–µ—Ç, –¥—Ä—É–∑—å—è! –°–µ–≥–æ–¥–Ω—è —Ö–æ—á—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –≤–∞–º–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º–∏ –æ —Ç–æ–º, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞—à–∞ –∏–Ω–¥—É—Å—Ç—Ä–∏—è. –£–≤–µ—Ä–µ–Ω, –º–Ω–æ–≥–∏–µ –∏–∑ –≤–∞—Å —É–∂–µ –∑–∞–º–µ—á–∞—é—Ç —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è!',
                    '–ó–Ω–∞–µ—Ç–µ, —á—Ç–æ –º–µ–Ω—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —É–¥–∏–≤–ª—è–µ—Ç? –¢–æ, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±–æ—è—Ç—Å—è –ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ, –æ–±–≥–æ–Ω—è—é—Ç —Ç–µ—Ö, –∫—Ç–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç "–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã". –¶–∏—Ñ—Ä—ã –≥–æ–≤–æ—Ä—è—Ç —Å–∞–º–∏ –∑–∞ —Å–µ–±—è ‚Äî –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–∞—é—Ç –ø—Ä–∏—Ä–æ—Å—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ 30%!',
                    '–î–∞–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏! –Ø –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏ –æ–±–º–µ–Ω–∞ –æ–ø—ã—Ç–æ–º. –ß—Ç–æ –≤—ã –¥—É–º–∞–µ—Ç–µ –æ–± —ç—Ç–∏—Ö —Ç—Ä–µ–Ω–¥–∞—Ö? –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö!'
                ];
            } else {
                paragraphs = [
                    '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ –ø—Ä–æ—Å—Ç–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–π, –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö. –ö–æ–º–ø–∞–Ω–∏–∏ –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏—â—É—Ç —Å–ø–æ—Å–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.',
                    '–°–æ–≥–ª–∞—Å–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ 15-25% –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø–æ–≤—ã—à–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ —É—Å–ª—É–≥.',
                    '–í–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —É—Å–ø–µ—à–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö —Å–¥–≤–∏–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏. –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç –æ–±—â–µ–µ –≤–∏–¥–µ–Ω–∏–µ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –Ω–∞–∏–ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.'
                ];
            }

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã
            if (length === 'short') {
                paragraphs = paragraphs.slice(0, 1);
            } else if (length === 'long') {
                paragraphs.push('–ë–æ–ª–µ–µ —Ç–æ–≥–æ, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ –∏ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏ —É—Å–ø–µ—Ö–∞. –ö–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–º–µ—é—Ç –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã, –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ä—ã–Ω–∫–∞–º –∏ —Ä–µ—Å—É—Ä—Å–∞–º.');
                paragraphs.push('–í –∑–∞–∫–ª—é—á–µ–Ω–∏–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É –æ–±—É—á–µ–Ω–∏—é ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è –≤ —ç–ø–æ—Ö—É —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ –æ—Å—Ç–∞—é—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –Ω–∞–¥–µ–∂–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —É—Å–ø–µ—Ö.');
            }

            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
            if (platform === 'twitter') {
                // –î–ª—è Twitter –¥–µ–ª–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç
                content = paragraphs[0];
            } else if (platform === 'instagram') {
                // –î–ª—è Instagram –¥–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏
                content = paragraphs.join('\n\n');
                content = content.replace('–≤–∞–∂–Ω–æ', '‚ö†Ô∏è –≤–∞–∂–Ω–æ');
                content = content.replace('—É—Å–ø–µ—Ö', '—É—Å–ø–µ—Ö üöÄ');
                content = content.replace('–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏', '–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ ‚ú®');
            } else {
                // –î–ª—è LinkedIn –∏ Facebook –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
                content = paragraphs.join('\n\n');
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ö—ç—à—Ç–µ–≥–∏
            let hashtags = '';
            if (prompt.toLowerCase().includes('–º–∞—Ä–∫–µ—Ç–∏–Ω–≥')) {
                hashtags = '<span class="preview-tag">#–º–∞—Ä–∫–µ—Ç–∏–Ω–≥</span> <span class="preview-tag">#—Å—Ç—Ä–∞—Ç–µ–≥–∏—è</span> <span class="preview-tag">#–±–∏–∑–Ω–µ—Å</span>';
            } else if (prompt.toLowerCase().includes('–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç')) {
                hashtags = '<span class="preview-tag">#–ò–ò</span> <span class="preview-tag">#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</span> <span class="preview-tag">#–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏</span>';
            } else {
                hashtags = '<span class="preview-tag">#–±–∏–∑–Ω–µ—Å</span> <span class="preview-tag">#—Ç—Ä–µ–Ω–¥—ã</span> <span class="preview-tag">#—Ä–∞–∑–≤–∏—Ç–∏–µ</span>';
            }

            return `<h4>${title}</h4><div class="ai-content-text">${content.replace(/\n\n/g, '<br><br>')}</div><div class="ai-suggested-tags mt-3"><p>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ö—ç—à—Ç–µ–≥–∏:</p>${hashtags}</div>`;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å" —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        useGeneratedBtn.addEventListener('click', function() {
            const generatedTitle = aiResultContent.querySelector('h4').textContent;
            const generatedContent = aiResultContent.querySelector('.ai-content-text').innerHTML.replace(/<br><br>/g, '\n\n');

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            document.getElementById('postTitle').value = generatedTitle;
            document.getElementById('postContent').value = generatedContent.replace(/<br>/g, '\n');

            // –î–æ–±–∞–≤–ª—è–µ–º —Ö—ç—à—Ç–µ–≥–∏
            const suggestedTags = aiResultContent.querySelectorAll('.ai-suggested-tags .preview-tag');
            suggestedTags.forEach(function(tag) {
                const tagText = tag.textContent.substring(1); // –£–±–∏—Ä–∞–µ–º #
                addTag(tagText);
            });

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            aiGeneratorModal.hide();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ"
        regenerateBtn.addEventListener('click', function() {
            generateBtn.click();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        editorButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                applyFormatting(action);
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫ —Ç–µ–∫—Å—Ç—É
        function applyFormatting(action) {
            const textarea = document.getElementById('postContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let formattedText = '';

            switch(action) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'underline':
                    formattedText = `_${selectedText}_`;
                    break;
                case 'heading':
                    formattedText = `## ${selectedText}`;
                    break;
                case 'list-ul':
                    formattedText = selectedText.split('\n').map(line => `‚Ä¢ ${line}`).join('\n');
                    break;
                case 'list-ol':
                    formattedText = selectedText.split('\n').map((line, index) => `${index + 1}. ${line}`).join('\n');
                    break;
                case 'link':
                    const url = prompt('{{ enter_url }}:', 'https://');
                    if (url) {
                        formattedText = `[${selectedText}](${url})`;
                    } else {
                        return;
                    }
                    break;
                case 'image':
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    imageInput.click();
                    return;
                case 'emoji':
                    // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏
                    const emojis = ['üòä', 'üëç', 'üéâ', 'üí°', '‚≠ê', 'üöÄ', 'üíº', 'üìä', 'üìà', 'üîç'];
                    const emojiList = emojis.map(emoji => `<button class="emoji-btn">${emoji}</button>`).join('');
                    const emojiSelector = document.createElement('div');
                    emojiSelector.className = 'emoji-selector';
                    emojiSelector.innerHTML = emojiList;

                    // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä —ç–º–æ–¥–∑–∏
                    const buttonRect = this.getBoundingClientRect();
                    emojiSelector.style.top = (buttonRect.bottom + window.scrollY) + 'px';
                    emojiSelector.style.left = (buttonRect.left + window.scrollX) + 'px';

                    document.body.appendChild(emojiSelector);

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —ç–º–æ–¥–∑–∏
                    const emojiButtons = emojiSelector.querySelectorAll('.emoji-btn');
                    emojiButtons.forEach(function(btn) {
                        btn.addEventListener('click', function() {
                            const emoji = this.textContent;
                            insertTextAtCursor(textarea, emoji);
                            emojiSelector.remove();
                        });
                    });

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                    document.addEventListener('click', function closeEmojiSelector(e) {
                        if (!emojiSelector.contains(e.target) && e.target !== document.querySelector('[data-action="emoji"]')) {
                            emojiSelector.remove();
                            document.removeEventListener('click', closeEmojiSelector);
                        }
                    });

                    return;
            }

            // –í—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.selectionStart = start;
            textarea.selectionEnd = start + formattedText.length;
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
        function insertTextAtCursor(textarea, text) {
            const start = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, start) + text + textarea.value.substring(textarea.selectionEnd);
            textarea.focus();
            textarea.selectionStart = start + text.length;
            textarea.selectionEnd = start + text.length;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫"
        saveDraftBtn.addEventListener('click', function() {
            savePost('draft');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"
        publishPostBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (validateForm()) {
                if (saveAsDraftCheckbox.checked) {
                    savePost('draft');
                } else if (schedulePostCheckbox.checked) {
                    savePost('scheduled');
                } else {
                    savePost('published');
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å" –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ
        publishFromPreviewBtn.addEventListener('click', function() {
            if (validateForm()) {
                savePost('published');
                previewModal.hide();
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
        function validateForm() {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            if (title === '') {
                alert('{{ enter_title }}');
                return false;
            }

            if (content === '') {
                alert('{{ enter_content }}');
                return false;
            }

            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–∞
        function savePost(status) {
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            const platform = document.querySelector('input[name="platform"]:checked').value;
            const image = previewImg.src;

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –µ—Å–ª–∏ –ø–æ—Å—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω
            let publishDate = null;
            if (status === 'scheduled') {
                const date = document.getElementById('publishDate').value;
                const time = document.getElementById('publishTime').value;
                publishDate = new Date(`${date}T${time}`);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤ –±—É–¥—É—â–µ–º
                if (publishDate <= new Date()) {
                    alert('{{ incorrect_pub_date }}');
                    return;
                }
            }

            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ—Å—Ç–∞
            const post = {
                id: generateUniqueId(),
                title: title,
                content: content,
                platform: platform,
                image: image,
                tags: tags,
                status: status,
                publishDate: publishDate,
                createdAt: new Date(),
                allowComments: document.getElementById('enableComments').checked
            };

            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã AJAX-–∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            savePostToLocalStorage(post);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
            showNotification(status);

            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–æ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                window.location.href = 'index.html';
            }, 2000);
        }

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–∞ –≤ localStorage
        function savePostToLocalStorage(post) {
            // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å—Ç—ã
            let posts = JSON.parse(localStorage.getItem('posts')) || [];

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ø–æ—Å—Ç
            posts.push(post);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
            localStorage.setItem('posts', JSON.stringify(posts));
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(status) {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.className = 'notification';

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
            let message = '';
            let icon = '';

            switch(status) {
                case 'published':
                    message = '{{ success_publish }}!';
                    icon = '<i class="ph ph-check-circle"></i>';
                    notification.classList.add('notification-success');
                    break;
                case 'draft':
                    message = '{{ draft_saved }}!';
                    icon = '<i class="ph ph-note-pencil"></i>';
                    notification.classList.add('notification-info');
                    break;
                case 'scheduled':
                    message = '{{ planed }}.';
                    icon = '<i class="ph ph-clock"></i>';
                    notification.classList.add('notification-info');
                    break;
            }

            notification.innerHTML = `${icon} <span>${message}</span>`;

            // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.body.appendChild(notification);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            setTimeout(function() {
                notification.classList.add('show');
            }, 10);

            // –°–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(function() {
                notification.classList.remove('show');
                setTimeout(function() {
                    notification.remove();
                }, 300);
            }, 2000);
        }
    });

</script>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ò–ò -->
<div class="modal fade" id="imageGeneratorModal" tabindex="-1" aria-labelledby="imageGeneratorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageGeneratorModalLabel">{{ ai_image_gen }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="imagePrompt" class="form-label">{{ describe }}</label>
                    <textarea class="form-control" id="imagePrompt" rows="3" placeholder="{{ example_1 }} {{ example_2 }} {{ example_3 }}"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">{{ image_style }}</label>
                    <div class="d-flex flex-wrap gap-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="styleRealistic" value="realistic" checked>
                            <label class="form-check-label" for="styleRealistic">{{ realistic }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="styleCartoon" value="cartoon">
                            <label class="form-check-label" for="styleCartoon">{{ cartoon }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="styleAbstract" value="abstract">
                            <label class="form-check-label" for="styleAbstract">{{ abstract }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageStyle" id="style3D" value="3d">
                            <label class="form-check-label" for="style3D">3D</label>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">{{ ratio }}</label>
                    <div class="d-flex flex-wrap gap-2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageRatio" id="ratio1x1" value="1:1" checked>
                            <label class="form-check-label" for="ratio1x1">{{ square }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageRatio" id="ratio4x3" value="4:3">
                            <label class="form-check-label" for="ratio4x3">{{ ratio_4_3 }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="imageRatio" id="ratio16x9" value="16:9">
                            <label class="form-check-label" for="ratio16x9">{{ ratio_16_9 }}</label>
                        </div>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
                <div id="imageGenerationResult" class="mt-4" style="display: none;">
                    <h6>{{ gen_result }}:</h6>
                    <div class="image-generation-container">
                        <div id="imageGenerationLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">{{ loading }}...</span>
                            </div>
                            <p class="mt-2">{{ image_gen }}...</p>
                            <small class="text-muted">{{ 30_second_to_mars }}</small>
                        </div>
                        <div id="generatedImageContainer" style="display: none;">
                            <img id="generatedImage" src="" alt="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" class="img-fluid rounded">
                        </div>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ -->
                    <div class="token-usage mt-3">
                        <small class="text-muted">{{ —Åoins_used }}: <span id="imageTokensUsed">0</span> / {{ max_coins }}</small>
                        <div class="progress token-progress mt-1">
                            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ cancel }}</button>
                <button type="button" class="btn btn-primary" id="generateImageBtnSubmit">{{ generate }}</button>
                <button type="button" class="btn btn-success" id="useGeneratedImageBtn" style="display: none;">
                    {{ use_image }}
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
        const generateImageBtn = document.getElementById('generateImageBtn');
        const imageGeneratorModalElement = document.getElementById('imageGeneratorModal');

        if (!generateImageBtn) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç —Å ID "generateImageBtn" –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        if (!imageGeneratorModalElement) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç —Å ID "imageGeneratorModal" –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –æ–±—ä–µ–∫—Ç bootstrap
        if (typeof bootstrap === 'undefined') {
            console.error('Bootstrap JS –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
            return;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const imageGeneratorModal = new bootstrap.Modal(imageGeneratorModalElement);

        // –ü–æ–ª—É—á–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        const generateImageBtnSubmit = document.getElementById('generateImageBtnSubmit');
        const imagePrompt = document.getElementById('imagePrompt');
        const imageGenerationResult = document.getElementById('imageGenerationResult');
        const imageGenerationLoading = document.getElementById('imageGenerationLoading');
        const generatedImageContainer = document.getElementById('generatedImageContainer');
        const generatedImage = document.getElementById('generatedImage');
        const useGeneratedImageBtn = document.getElementById('useGeneratedImageBtn');
        const imageTokensUsed = document.getElementById('imageTokensUsed');
        const previewImg = document.getElementById('previewImg');
        const imagePreview = document.getElementById('imagePreview');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        if (!generateImageBtnSubmit || !imagePrompt || !imageGenerationResult ||
            !imageGenerationLoading || !generatedImageContainer || !generatedImage ||
            !useGeneratedImageBtn || !imageTokensUsed || !previewImg || !imagePreview) {
            console.error('–ù–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã');
            return;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ —Å –ø–æ–º–æ—â—å—é –ò–ò"
        generateImageBtn.addEventListener('click', function() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            imageGenerationResult.style.display = 'none';
            generatedImageContainer.style.display = 'none';
            useGeneratedImageBtn.style.display = 'none';
            imagePrompt.value = '';

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            imageGeneratorModal.show();
        });

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        generateImageBtnSubmit.addEventListener('click', function() {
            const prompt = imagePrompt.value.trim();
            if (prompt === '') {
                alert('{{ enter_description }}');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∏ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω
            const style = document.querySelector('input[name="imageStyle"]:checked').value;
            const ratio = document.querySelector('input[name="imageRatio"]:checked').value;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            imageGenerationResult.style.display = 'block';
            imageGenerationLoading.style.display = 'block';
            generatedImageContainer.style.display = 'none';
            useGeneratedImageBtn.style.display = 'none';

            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API
            setTimeout(function() {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É —Å —Å–ª—É—á–∞–π–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                generateDummyImage(prompt, style, ratio);

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–∫–µ–Ω–æ–≤
                const tokens = Math.floor(Math.random() * 800) + 200;
                imageTokensUsed.textContent = tokens;
                document.querySelector('#imageGenerationResult .progress-bar').style.width = (tokens / 5000 * 100) + '%';

                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                imageGenerationLoading.style.display = 'none';
                generatedImageContainer.style.display = 'block';
                useGeneratedImageBtn.style.display = 'inline-block';
            }, 3000);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∑–∞–≥–ª—É—à–∫–∞)
        function generateDummyImage(prompt, style, ratio) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω
            let width, height;
            switch(ratio) {
                case '1:1':
                    width = 512;
                    height = 512;
                    break;
                case '4:3':
                    width = 640;
                    height = 480;
                    break;
                case '16:9':
                    width = 640;
                    height = 360;
                    break;
                default:
                    width = 512;
                    height = 512;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å Unsplash Source
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let keywords = prompt.split(' ').slice(0, 3).join(',');

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –≤ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            if (style === 'realistic') keywords += ',photo';
            if (style === 'cartoon') keywords += ',illustration';
            if (style === 'abstract') keywords += ',abstract';
            if (style === '3d') keywords += ',3d';

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º URL –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imageUrl = `https://source.unsplash.com/random/${width}x${height}/?${encodeURIComponent(keywords)}`;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            generatedImage.src = imageUrl;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
        useGeneratedImageBtn.addEventListener('click', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            previewImg.src = generatedImage.src;
            imagePreview.style.display = 'block';
            document.querySelector('.image-upload-placeholder').style.display = 'none';

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            imageGeneratorModal.hide();
        });
    });
    </script>

<!-- Phosphor Icons JavaScript -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>



{% endblock %}
