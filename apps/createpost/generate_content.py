from django.http import JsonResponse
from django.views.decorators.http import require_POST
import json

def generate_dummy_content(prompt, tone, length):
    # Генерируем заголовок в зависимости от запроса
    if 'маркетинг' in prompt.lower():
        title = '5 инновационных стратегий маркетинга, которые нельзя игнорировать в 2023 году'
    elif 'искусственный интеллект' in prompt.lower() or 'ии' in prompt.lower():
        title = 'Как искусственный интеллект трансформирует бизнес-процессы уже сегодня'
    elif 'продажи' in prompt.lower():
        title = 'Увеличение продаж на 30%: проверенные методы, которые работают'
    else:
        title = 'Тренды индустрии, которые изменят ваш бизнес в ближайшие 5 лет'

    # Генерируем контент в зависимости от тона
    paragraphs = []
    if tone == 'professional':
        paragraphs = [
            '1В современном быстро меняющемся бизнес-ландшафте критически важно оставаться в курсе последних тенденций и инноваций. Компании, которые адаптируются к изменениям, получают значительное конкурентное преимущество.',
            'Исследования показывают, что организации, инвестирующие в новые технологии, демонстрируют на 26% более высокую прибыльность по сравнению с конкурентами. Это подчеркивает важность стратегического подхода к внедрению инноваций.',
            'Для достижения оптимальных результатов рекомендуется разработать детальную дорожную карту трансформации, учитывающую как краткосрочные выгоды, так и долгосрочные стратегические цели компании.'
        ]
    elif tone == 'friendly':
        paragraphs = [
            '2Привет, друзья! Сегодня хочу поделиться с вами некоторыми интересными наблюдениями о том, как меняется наша индустрия. Уверен, многие из вас уже замечают эти изменения!',
            'Знаете, что меня больше всего удивляет? То, как быстро компании, которые не боятся пробовать новое, обгоняют тех, кто предпочитает "проверенные методы". Цифры говорят сами за себя — инновационные подходы дают прирост эффективности до 30%!',
            'Давайте вместе исследовать эти возможности! Я всегда открыт для обсуждения и обмена опытом. Что вы думаете об этих трендах? Поделитесь своим мнением в комментариях!'
        ]
    else:
        paragraphs = [
            '3Трансформация бизнес-процессов становится не просто желательной, а необходимой для выживания в современных условиях. Компании всех размеров ищут способы оптимизации и повышения эффективности.',
            'Согласно последним исследованиям, внедрение инновационных подходов позволяет сократить операционные расходы на 15-25% при одновременном повышении качества продуктов и услуг.',
            'Важно отметить, что успешная трансформация требует не только технологических изменений, но и культурных сдвигов внутри организации. Команды, которые разделяют общее видение и ценности, демонстрируют наилучшие результаты.'
        ]

    # Корректируем количество параграфов в зависимости от длины
    if length == 'short':
        paragraphs = paragraphs[:1]
    elif length == 'long':
        paragraphs.extend([
            'Более того, стратегическое партнерство и коллаборации становятся ключевыми факторами успеха. Компании, которые умеют выстраивать эффективные экосистемы, получают доступ к новым рынкам и ресурсам.',
            'В заключение хотелось бы подчеркнуть, что адаптивность и готовность к постоянному обучению — это фундаментальные качества, необходимые для процветания в эпоху цифровой трансформации. Инвестиции в развитие человеческого капитала остаются одним из самых надежных способов обеспечить долгосрочный успех.'
        ])

    content = paragraphs[0]

    # Формируем хэштеги
    if 'маркетинг' in prompt.lower():
        hashtags = '<span class="preview-tag">#маркетинг</span> <span class="preview-tag">#стратегия</span> <span class="preview-tag">#бизнес</span>'
    elif 'искусственный интеллект' in prompt.lower():
        hashtags = '<span class="preview-tag">#ИИ</span> <span class="preview-tag">#технологии</span> <span class="preview-tag">#инновации</span>'
    else:
        hashtags = '<span class="preview-tag">#бизнес</span> <span class="preview-tag">#тренды</span> <span class="preview-tag">#развитие</span>'

    # Выполняем замену вне f-строки
    formatted_content = content.replace('\n\n', '<br><br>')
    return f'<h4>{title}</h4><div class="ai-content-text">{formatted_content}</div><div class="ai-suggested-tags mt-3"><p>Рекомендуемые хэштеги:</p>{hashtags}</div>'


@require_POST
def generate_content_api(request):
    try:
        # Получаем данные из POST-запроса
        data = json.loads(request.body)
        prompt = data.get('prompt', '')
        tone = data.get('tone', 'professional')
        length = data.get('length', 'medium')

        # Вызываем функцию генерации контента
        generated_content = generate_dummy_content(prompt, tone, length)

        # Формируем ответ
        response = {
            'status': 'success',
            'content': generated_content,
            'tokens_used': 100,  # Здесь можно добавить логику подсчета токенов, если нужно
        }
        return JsonResponse(response)
    except Exception as e:
        return JsonResponse({'status': 'error', 'message': str(e)}, status=400)
